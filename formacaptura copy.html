<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario Bootstrap</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- Incluir SweetAlert -->

    <style>
        /* Ajustes generales de fuente */
        .container {
            font-size: 1.2rem; /* Aumentar el tamaño de la fuente para todo el formulario */
        }

        /* Ajusta el tamaño de las etiquetas */
        .form-label {
            font-size: 1.5rem; /* Aumentar tamaño de las etiquetas */
        }

        .btn-default:hover, .btn-default:focus, .btn-default.focus, .btn-default:active, .btn-default.active, .open>.dropdown-toggle.btn-default {
            color: #333;
            background-color: #e6e6e6;
            border-color: #adadad;
        }

        /* Aumentar el tamaño de los inputs, select y textarea */
        .form-control, .form-select, .form-textarea {
            font-size: 1rem; /* Aumentar tamaño de los campos de entrada */
            padding: 0.1rem; /* Añadir más espacio dentro de los campos */
        }

        /* Aumentar el tamaño de los botones */
        .btn {
            font-size: 1.5rem; /* Aumentar el tamaño de los botones */
            border-color: #ccc;
        }

        /* Asegurar que los elementos del formulario usen el 100% del ancho disponible */
        .form-control, .form-select {
            width: 100%;
        }

        /* Ajustar el tamaño de fuente dentro de los contenedores */
        .form-control, .form-select, .form-textarea {
            font-size: 1.5rem; /* Asegura que el texto dentro de los inputs sea más grande */
            line-height: 1.75; /* Ajusta la altura de la línea dentro del contenedor */
            padding: 0.75rem 1rem; /* Añade espacio adicional dentro del contenedor */
            height: auto; /* Permite que la altura del contenedor se ajuste según el contenido */
        }

        /* Asegura que los contenedores de formularios no se desborden */
        .container.mt-5 {
            padding: 20px;
        }

        /* Estilos específicos para pantallas pequeñas (responsividad) */
        @media (max-width: 768px) {
            .container {
                font-size: 1rem; /* Reducir tamaño de texto en pantallas más pequeñas */
            }

            .form-label {
                font-size: 1rem;
            }

            .btn {
                font-size: 1rem;
            }
        }

        /* Estilo para la imagen */
        #preview-image {
            width: 100%;         /* La imagen ocupa todo el ancho del contenedor */
            height: auto;        /* Mantiene la relación de aspecto original */
            object-fit: contain; /* La imagen se ajusta sin recortarse ni deformarse */
            max-height: 100%;    /* Limita la altura para no exceder el contenedor */
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <!-- Espacio para la imagen -->
        <div class="mb-3 text-center">
            <img id="preview-image" src="./img/nomapa.png" alt="Vista previa" class="img-fluid rounded">
        </div>

           <!-- Controles -->
           <div id="controls" class="text-center mt-4">
            <button class="btn btn-primary mx-2" onclick="adjustBbox(-0.0001)">Acercar</button>
            <button class="btn btn-secondary mx-2" onclick="adjustBbox(0.0001)">Alejar</button>
        </div>


        <form id="formulario">

             <!-- Campo URL Imagen (textarea) -->
             <div class="mb-3">
                <label for="urlimagen" class="form-label">Url Imagen</label>
                <textarea class="form-control" id="urlimagen" rows="1" required ></textarea>
            </div>

            <!-- Campo Plan Parcial (texto) -->
            <div class="mb-3">
                <label for="planparcial" class="form-label">Plan Parcial</label>
                <input type="text" class="form-control" id="planparcial" required >
            </div>

            <!-- Campo Uso de Suelo (texto) -->
            <div class="mb-3">
                <label for="claveusosuelo" class="form-label">Clave de Uso de Suelo</label>
                <input type="text" class="form-control" id="claveusosuelo" required disabled>
            </div>

            <!-- Campo Uso de Suelo (texto) -->
            <div class="mb-3">
                <label for="usosuelo" class="form-label">Uso de Suelo</label>
                <input type="text" class="form-control" id="usosuelo" required disabled>
            </div>

            <!-- Campo Entorno (textarea) -->
            <div class="mb-3">
                <label for="entorno" class="form-label">Entorno</label>
                <textarea class="form-control" id="entorno" rows="1" required ></textarea>
            </div>

              <!-- Campo DICTAMEN  (numérico o texto) -->
              <div class="mb-3">
                <label for="restriccion" class="form-label">Restricción</label>
                <input type="text" class="form-control" id="restriccion" required disabled>
            </div>


          
            <!-- Campo Longitud (texto) -->
            <div class="mb-3">
                <label for="longitud" class="form-label">Longitud</label>
                <input type="text" class="form-control" id="longitud" required >
            </div>

            <!-- Campo Latitud (texto) -->
            <div class="mb-3">
                <label for="latitud" class="form-label">Latitud</label>
                <input type="text" class="form-control" id="latitud" required >
            </div>

            <!-- Campo Bbox (texto) -->
            <div class="mb-3">
                <label for="bbox" class="form-label">Bbox</label>
                <input type="text" class="form-control" id="bbox" required >
            </div>



           

            
            <!-- Campo NGID (numérico) -->
            <div class="mb-3">
                <label for="ngid" class="form-label">NGID</label>
                <input type="number" class="form-control" id="ngid" required>
            </div>

            <!-- Campo Nombre (texto) -->
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre</label>
                <textarea class="form-control" id="nombre" rows="1" required disabled></textarea>
            </div>

            <!-- Campo Distrito (numérico o texto) -->
            <div class="mb-3">
                <label for="distrito" class="form-label">Distrito</label>
                <input type="text" class="form-control" id="distrito" required disabled>
            </div>

            <!-- Campo Dependencia (texto) -->
            <div class="mb-3">
                <label for="dependencia" class="form-label">Dependencia</label>
                <input type="text" class="form-control" id="dependencia" required >
            </div>

            <!-- Campo Expediente (texto) -->
            <div class="mb-3">
                <label for="expediente" class="form-label">Expediente</label>
                <input type="text" class="form-control" id="expediente" required >
            </div>

            <!-- Campo Antecedentes (textarea) -->
            <div class="mb-3">
                <label for="antecedentes" class="form-label">Antecedentes</label>
                <textarea class="form-control" id="antecedentes" rows="1" required ></textarea>
            </div>

            <!-- Campo UrlPlano (textarea) -->
            <div class="mb-3">
                <label for="urlplano" class="form-label">UrlPlano</label>
                <textarea class="form-control" id="urlplano" rows="1" required ></textarea>
            </div>

            <!-- Campo VoboMesa (texto con opciones 0/1 o No/Si) -->
            <div class="mb-3">
                <label for="vobomesa" class="form-label">VoboMesa</label>
                <select class="form-select" id="vobomesa" required disabled>
                    <option value="1">Sí</option>
                    <option value="0">No</option>
                </select>
            </div>

            <!-- Campo Observaciones (textarea) -->
            <div class="mb-3">
                <label for="observaciones" class="form-label">Observaciones</label>
                <textarea class="form-control" id="observaciones" rows="1" disabled></textarea>
            </div>

            <!-- Botones de acción -->
            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-primary" id="btn-aceptar" disabled>Aceptar</button>
                <button type="button" class="btn btn-secondary" id="btn-cancelar" onclick="cancelarFormulario()">Cancelar</button>
                <button type="button" class="btn btn-warning" id="btn-actualizar">Actualizar</button>
                <button type="button" class="btn btn-danger" id="btn-eliminar" >Eliminar</button>
            </div>
        </form>
    </div>

    <script>
        const formulario = document.getElementById("formulario");
        const ngid = document.getElementById("ngid");
        const previewImage = document.getElementById("preview-image");
        const inputs = formulario.querySelectorAll(".form-control, .form-select, .form-textarea");
        const btnAceptar = document.getElementById("btn-aceptar");
        const btnActualizar = document.getElementById("btn-actualizar");
        const btnEliminar = document.getElementById("btn-eliminar");



        let enModoEdicion = false;

        function toggleInputs(disabled) {
            inputs.forEach(input => {
                if (input.id !== "ngid") {
                    input.disabled = disabled;
                }
            });
        }

        function validarNGID() {
            return ngid.value && ngid.value.trim() !== "";
        }

        function cancelarFormulario() {
            formulario.reset();
            toggleInputs(true);
            previewImage.src = "./img/nomapa.png";
            btnAceptar.disabled = true;
            btnActualizar.disabled = false;
            enModoEdicion = false;
        }

        function deleteForm() {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¿Deseas eliminar los datos?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    formulario.reset();
                    toggleInputs(true);
                    previewImage.src = "./img/nomapa.png";
                    btnAceptar.disabled = true;
                    btnActualizar.disabled = false;
                    enModoEdicion = false;
                    Swal.fire('Eliminado', 'Los datos han sido eliminados', 'success');
                }
            });
        }

        btnActualizar.addEventListener("click", () => {
            if (!validarNGID()) {
                Swal.fire('Error', 'NGID es obligatorio.', 'error');
                return;
            }
            toggleInputs(false);
            btnActualizar.disabled = true;
            btnAceptar.disabled = false;
            enModoEdicion = true;
        });

        btnAceptar.addEventListener("click", () => {
            // Confirmación con SweetAlert antes de ejecutar el AJAX
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¿Deseas guardar los cambios?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, guardar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    const datos = {
                        ngid: document.getElementById("ngid").value,
                        nombre: document.getElementById("nombre").value.trim() || null,
                        distrito: document.getElementById("distrito").value.trim() || null,
                        dependencia: document.getElementById("dependencia").value.trim() || null,
                        expediente: document.getElementById("expediente").value.trim() || null,
                        antecedentes: document.getElementById("antecedentes").value.trim() || null,
                        urlplano: document.getElementById("urlplano").value.trim() || null,
                        vobomesa: document.getElementById("vobomesa").value.trim() || null,
                        observaciones: document.getElementById("observaciones").value.trim() || null
                    };

            
                    $.ajax({ 
                        url: "./bd/updatecolonias.php",
                        type: "POST",
                        data: datos,
                        dataType: "json",
                        success: function (response) {
                            console.log(response);
                            Swal.fire('Éxito', 'Datos actualizados correctamente.', 'success');
                            toggleInputs(true);
                            btnActualizar.disabled = false;
                            btnAceptar.disabled = true;
                        },
                        error: function (error) {
                            console.error("Error en la solicitud:", error);
                            Swal.fire('Error', 'Error al actualizar los datos.', 'error');
                        },
                    });
                } else {
                    Swal.fire('Cancelado', 'La acción ha sido cancelada.', 'info');
                }
            });
        });



        btnEliminar.addEventListener("click", () => {
            // Confirmación con SweetAlert antes de ejecutar el AJAX
            Swal.fire({
                title: '¿Estás seguro?',
                text: "¿Deseas elimimar la colonia?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, Eliminar',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    const datos = {
                        ngid: document.getElementById("ngid").value
                    };

            
                    $.ajax({ 
                        url: "./bd/deletecolonias.php",
                        type: "POST",
                        data: datos,
                        dataType: "json",
                        success: function (response) {
                            console.log(response);
                            Swal.fire('Éxito', 'Colonia eliminada correctamente.', 'success');
                            toggleInputs(true);
                            btnActualizar.disabled = false;
                            btnAceptar.disabled = true;
                            cancelarFormulario();
                        },
                        error: function (error) {
                            console.error("Error en la solicitud:", error);
                            Swal.fire('Error', 'Error al eliminar los datos.', 'error');
                        },
                    });
                } else {
                    Swal.fire('Cancelado', 'La acción ha sido cancelada.', 'info');
                }
            });
        });



        toggleInputs(true);
        previewImage.src = "./img/nomapa.png";
    </script>

<script>
  window.onload = function() {
    // Variables iniciales para el bbox y el centro
    let bboxValue = document.getElementById("bbox").value;
    if (bboxValue) {
        let bbox = bboxValue.split(',').map(Number); // Convertir a un arreglo de números
    } else {
        console.error("El valor de bbox no está definido.");
        return; // Salir si bbox no tiene valor
    }

    const centerLong = parseFloat(document.getElementById("longitud").value);
    const centerLat = parseFloat(document.getElementById("latitud").value);

    if (isNaN(centerLong) || isNaN(centerLat)) {
        console.error("Las coordenadas de longitud y latitud no son válidas.");
        return; // Salir si longitud o latitud no son números válidos
    }

    // Función para calcular un nuevo bbox basado en un factor de ajuste (zoom)
    window.adjustBbox = function(delta) {  // Hacerla globalmente accesible
        const bboxWidth = bbox[2] - bbox[0];
        const bboxHeight = bbox[3] - bbox[1];
        const newWidth = bboxWidth + delta;
        const newHeight = bboxHeight + delta;

        // Recalcular bbox manteniendo el centro
        bbox[0] = centerLong - newWidth / 2; // minx
        bbox[1] = centerLat - newHeight / 2; // miny
        bbox[2] = centerLong + newWidth / 2; // maxx
        bbox[3] = centerLat + newHeight / 2; // maxy

        updateMap();
    };

    // Función para actualizar la imagen WMS y mostrar la URL
    function updateMap() {
        const bboxStr = bbox.map(coord => coord.toFixed(10)).join(",");
        
        const url2 = `https://mapa.zapopan.gob.mx:8000/geoserver/geomatica/wms?service=WMS&version=1.1.0&request=GetMap&layers=geomatica%3AOSM-WMS,geomatica%3Appdu_zonificacion_manzana,geomatica%3APredios_PPDU,geomatica%3Appdu_zonificacion,geomatica%3Aubicacion&viewparams=longitud%3A${centerLong};latitud%3A${centerLat}&bbox=${bboxStr}&width=300&height=300&srs=EPSG%3A4326&format=image%2Fpng`;

        // Actualizar la imagen
        document.getElementById("preview-image").src = url2;

        // Mostrar la URL en el área de texto
        document.getElementById("urlimagen").value = url2;
    }

    // Inicializar el mapa con la URL inicial
    updateMap();
}


</script>



</body>
</html>
